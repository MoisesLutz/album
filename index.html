<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üíñ Nosso √Ålbum üíñ</title>
  <style>
    body {font-family: 'Poppins', sans-serif; background-color: #fff7fa; margin: 0; text-align: center; color: #333}
    header {background-color: #ff8fb1; color: white; padding: 15px; font-size: 1.4em; font-weight: bold}
    .contador {margin: 12px auto; display: inline-block; background: white; padding: 12px 18px; border-radius: 10px; box-shadow: 0 0 8px rgba(0,0,0,0.06)}
    .album-list {display:flex;flex-wrap:wrap;justify-content:center;gap:12px;padding:16px}
    .album {background:white;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);padding:16px;width:150px;position:relative;cursor:pointer}
    .album:hover{transform:scale(1.03)}
    .delete-btn{position:absolute;top:6px;right:6px;background:#ff4f88;color:#fff;border:none;border-radius:50%;width:26px;height:26px;cursor:pointer}
    .galeria{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;padding:16px;max-width:980px;margin:auto}
    .galeria img,.galeria video{width:100%;border-radius:10px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.08)}
    .empty{grid-column:1/-1;border:2px dashed #ff8fb1;color:#c66;padding:20px;border-radius:10px}
    button{background:#ff8fb1;color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:600}
    button:hover{background:#ff6f99}
    @media(max-width:480px){header{font-size:1.2em;padding:12px}.contador{padding:10px}}
  </style>
</head>
<body>
  <header>üíñ Nosso √Ålbum üíñ</header>

  <div class="contador">
    <div>Estamos juntos h√°:</div>
    <div style="font-weight:700;font-size:1.1rem" id="tempo">-- anos, -- meses e -- dias</div>
    <div id="hms" style="color:#666;margin-top:6px">--:--:--</div>
    <div id="totalDias" style="color:#777;margin-top:6px">(-- dias no total)</div>
  </div>

  <div id="telaAlbuns">
    <div class="album-list" id="listaAlbuns"></div>
    <button id="novoAlbum">+ Novo Destaque</button>
  </div>

  <div id="telaGaleria" style="display:none">
    <h2 id="tituloAlbum"></h2>
    <div style="display:flex;gap:8px;justify-content:center;margin-bottom:10px">
      <button id="voltar">‚¨Ö Voltar</button>
      <button id="addFoto">Adicionar foto/v√≠deo</button>
    </div>
    <input type="file" id="fileInput" accept="image/*,video/*" multiple hidden />
    <div class="galeria" id="galeria"></div>
  </div>

  <!-- Firebase + Script principal -->
  <script type="module">
    // ====== CONFIGURA√á√ÉO FIREBASE ======
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { 
      getFirestore, doc, setDoc, getDoc, getDocs, collection, deleteDoc 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { 
      getStorage, ref, uploadBytes, getDownloadURL, deleteObject 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

    // üëâ Substitua por suas credenciais
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      projectId: "SEU_PROJETO",
      storageBucket: "SEU_PROJETO.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abc123"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // ====== CONTADOR DE TEMPO ======
    const START_DATE = new Date(2022, 9, 8);
    function calcularTempoJuntos() {
      const agora = new Date();
      let anos = agora.getFullYear() - START_DATE.getFullYear();
      let meses = agora.getMonth() - START_DATE.getMonth();
      let dias = agora.getDate() - START_DATE.getDate();

      if (dias < 0) {
        const ultimoMes = new Date(agora.getFullYear(), agora.getMonth(), 0);
        dias += ultimoMes.getDate();
        meses--;
      }
      if (meses < 0) { meses += 12; anos--; }

      const totalDias = Math.floor((agora - START_DATE) / (1000 * 60 * 60 * 24));
      document.getElementById("tempo").textContent = 
        `${anos} ${anos===1?"ano":"anos"}, ${meses} ${meses===1?"m√™s":"meses"} e ${dias} ${dias===1?"dia":"dias"}`;
      document.getElementById("hms").textContent = 
        `${String(agora.getHours()).padStart(2,"0")}:${String(agora.getMinutes()).padStart(2,"0")}:${String(agora.getSeconds()).padStart(2,"0")}`;
      document.getElementById("totalDias").textContent = `${totalDias} dias no total`;
    }
    setInterval(calcularTempoJuntos, 1000);

    // ====== ELEMENTOS ======
    const listaAlbuns = document.getElementById('listaAlbuns');
    const telaAlbuns = document.getElementById('telaAlbuns');
    const telaGaleria = document.getElementById('telaGaleria');
    const galeria = document.getElementById('galeria');
    const tituloAlbum = document.getElementById('tituloAlbum');
    const fileInput = document.getElementById('fileInput');
    let albumAtual = null;

    // ====== FUN√á√ïES FIREBASE ======
    async function salvarAlbumNoFirebase(nome) {
      await setDoc(doc(db, "albuns", nome), { criadoEm: new Date().toISOString() });
    }

    async function deletarAlbumFirebase(nome) {
      await deleteDoc(doc(db, "albuns", nome));
    }

    async function listarAlbunsFirebase() {
      const snapshot = await getDocs(collection(db, "albuns"));
      return snapshot.docs.map(d => d.id);
    }

    async function uploadMidiaFirebase(album, file) {
      const path = `albuns/${album}/${Date.now()}-${file.name}`;
      const storageRef = ref(storage, path);
      await uploadBytes(storageRef, file);
      return await getDownloadURL(storageRef);
    }

    // ====== ALBUNS ======
    async function mostrarAlbunsFirebase() {
      listaAlbuns.innerHTML = '';
      const nomes = await listarAlbunsFirebase();
      if (nomes.length === 0) {
        listaAlbuns.innerHTML = '<div style="color:#777;padding:8px">Nenhum destaque ‚Äî crie um!</div>';
        return;
      }
      nomes.forEach(nome => {
        const div = document.createElement('div');
        div.className = 'album';
        div.textContent = nome;

        const btnExcluir = document.createElement('button');
        btnExcluir.className = 'delete-btn';
        btnExcluir.textContent = '√ó';
        btnExcluir.onclick = async (e) => {
          e.stopPropagation();
          if (!confirm(`Excluir o destaque "${nome}"?`)) return;
          await deletarAlbumFirebase(nome);
          await mostrarAlbunsFirebase();
        };

        div.appendChild(btnExcluir);
        div.onclick = () => abrirAlbum(nome);
        listaAlbuns.appendChild(div);
      });
    }

    document.getElementById('novoAlbum').onclick = async () => {
      const nome = prompt('Nome do novo destaque:');
      if (!nome) return;
      await salvarAlbumNoFirebase(nome);
      await mostrarAlbunsFirebase();
    };

    // ====== GALERIA ======
    async function abrirAlbum(nome) {
      albumAtual = nome;
      tituloAlbum.textContent = nome;
      telaAlbuns.style.display = 'none';
      telaGaleria.style.display = 'block';
      await mostrarGaleriaFirebase();
    }

    async function mostrarGaleriaFirebase() {
      galeria.innerHTML = '';
      const snap = await getDocs(collection(db, "albuns", albumAtual, "midias"));
      if (snap.empty) {
        galeria.innerHTML = '<div class="empty">Nenhuma m√≠dia adicionada</div>';
        return;
      }

      snap.forEach(docu => {
        const m = docu.data();
        const el = document.createElement(m.tipo === 'video' ? 'video' : 'img');
        el.src = m.url;
        if (m.tipo === 'video') el.controls = true;
        el.onclick = async () => {
          if (!confirm('Remover esta m√≠dia?')) return;
          await deleteDoc(doc(db, "albuns", albumAtual, "midias", docu.id));
          const storageRef = ref(storage, m.path);
          await deleteObject(storageRef);
          mostrarGaleriaFirebase();
        };
        galeria.appendChild(el);
      });
    }

    document.getElementById('voltar').onclick = () => {
      telaAlbuns.style.display = 'block';
      telaGaleria.style.display = 'none';
      mostrarAlbunsFirebase();
    };

    document.getElementById('addFoto').onclick = () => fileInput.click();

    fileInput.onchange = async (e) => {
      const files = Array.from(e.target.files);
      if (!files.length) return;

      for (const file of files) {
        const tipo = file.type.startsWith('video') ? 'video' : 'img';
        const url = await uploadMidiaFirebase(albumAtual, file);
        const midiaRef = doc(collection(db, "albuns", albumAtual, "midias"));
        await setDoc(midiaRef, { tipo, url, path: `albuns/${albumAtual}/${file.name}` });
      }

      await mostrarGaleriaFirebase();
      fileInput.value = '';
    };

    // inicializa
    mostrarAlbunsFirebase();
  </script>
</body>
</html>
