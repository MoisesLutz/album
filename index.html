<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üíñ Nosso √Ålbum üíñ</title>
  <style>
    body {font-family: 'Poppins', sans-serif; background-color: #fff7fa; margin: 0; text-align: center; color: #333}
    header {background-color: #ff8fb1; color: white; padding: 15px; font-size: 1.4em; font-weight: bold}
    .contador {margin: 12px auto; display: inline-block; background: white; padding: 12px 18px; border-radius: 10px; box-shadow: 0 0 8px rgba(0,0,0,0.06)}
    .album-list {display:flex;flex-wrap:wrap;justify-content:center;gap:12px;padding:16px}
    .album {background:white;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);padding:16px;width:150px;position:relative;cursor:pointer}
    .album:hover{transform:scale(1.03)}
    .delete-btn{position:absolute;top:6px;right:6px;background:#ff4f88;color:#fff;border:none;border-radius:50%;width:26px;height:26px;cursor:pointer}
    .galeria{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;padding:16px;max-width:980px;margin:auto}
    .galeria img,.galeria video{width:100%;border-radius:10px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.08)}
    .empty{grid-column:1/-1;border:2px dashed #ff8fb1;color:#c66;padding:20px;border-radius:10px}
    button{background:#ff8fb1;color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:600}
    button:hover{background:#ff6f99}
    @media(max-width:480px){header{font-size:1.2em;padding:12px}.contador{padding:10px}}
  </style>
</head>
<body>
  <header>üíñ Nosso √Ålbum üíñ</header>

  <div class="contador">
    <div>Estamos juntos h√°:</div>
    <div style="font-weight:700;font-size:1.1rem" id="tempo">-- anos, -- meses e -- dias</div>
    <div id="hms" style="color:#666;margin-top:6px">--:--:--</div>
    <div id="totalDias" style="color:#777;margin-top:6px">(-- dias no total)</div>
  </div>

  <div id="telaAlbuns">
    <div class="album-list" id="listaAlbuns"></div>
    <button id="novoAlbum">+ Novo Destaque</button>
  </div>

  <div id="telaGaleria" style="display:none">
    <h2 id="tituloAlbum"></h2>
    <div style="display:flex;gap:8px;justify-content:center;margin-bottom:10px">
      <button id="voltar">‚¨Ö Voltar</button>
      <button id="addFoto">Adicionar foto/v√≠deo</button>
    </div>
    <input type="file" id="fileInput" accept="image/*,video/*" multiple hidden />
    <div class="galeria" id="galeria"></div>
  </div>

  <script type="module">
    // =============================
    // üî• CONFIGURA√á√ÉO DO FIREBASE
    // =============================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { 
      getFirestore, doc, getDoc, setDoc, onSnapshot, deleteField, updateDoc 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { 
      getStorage, ref, uploadBytes, getDownloadURL, deleteObject 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBbrO1OmACUCw7FQu-IM_6ZmshF8ZZ5r0o",
      authDomain: "album-destaques.firebaseapp.com",
      projectId: "album-destaques",
      storageBucket: "album-destaques.appspot.com",
      messagingSenderId: "904173934936",
      appId: "1:904173934936:web:b51bfa7f409005f39b6b0f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);
    const albunsRef = doc(db, "albuns", "destaques");

    // =============================
    // ‚è∞ CONTADOR DE NAMORO
    // =============================
    const START_DATE = new Date(2022, 9, 8);
    function calcularTempoJuntos() {
      const agora = new Date();
      let anos = agora.getFullYear() - START_DATE.getFullYear();
      let meses = agora.getMonth() - START_DATE.getMonth();
      let dias = agora.getDate() - START_DATE.getDate();
      if (dias < 0) {
        const ultimoMes = new Date(agora.getFullYear(), agora.getMonth(), 0);
        dias += ultimoMes.getDate();
        meses--;
      }
      if (meses < 0) {
        meses += 12;
        anos--;
      }
      const totalDias = Math.floor((agora - START_DATE) / (1000 * 60 * 60 * 24));
      document.getElementById("tempo").textContent = 
        `${anos} ${anos===1?"ano":"anos"}, ${meses} ${meses===1?"m√™s":"meses"} e ${dias} ${dias===1?"dia":"dias"}`;
      const h = String(agora.getHours()).padStart(2,'0');
      const m = String(agora.getMinutes()).padStart(2,'0');
      const s = String(agora.getSeconds()).padStart(2,'0');
      document.getElementById("hms").textContent = `${h}:${m}:${s}`;
      document.getElementById("totalDias").textContent = `${totalDias} dias no total`;
    }
    setInterval(calcularTempoJuntos, 1000);

    // =============================
    // üíæ √ÅLBUNS E GALERIA
    // =============================
    const listaAlbuns = document.getElementById("listaAlbuns");
    const telaAlbuns = document.getElementById("telaAlbuns");
    const telaGaleria = document.getElementById("telaGaleria");
    const galeria = document.getElementById("galeria");
    const tituloAlbum = document.getElementById("tituloAlbum");
    const fileInput = document.getElementById("fileInput");
    let albumAtual = null;

    function mostrarAlbuns(albuns) {
      listaAlbuns.innerHTML = "";
      const nomes = Object.keys(albuns || {});
      if (nomes.length === 0) {
        listaAlbuns.innerHTML = '<div style="color:#777;padding:8px">Nenhum destaque ‚Äî crie um!</div>';
        return;
      }
      nomes.forEach(nome => {
        const div = document.createElement("div");
        div.className = "album";
        const btnExcluir = document.createElement("button");
        btnExcluir.className = "delete-btn";
        btnExcluir.textContent = "√ó";
        btnExcluir.onclick = async (e) => {
          e.stopPropagation();
          if (!confirm(`Excluir o destaque "${nome}"?`)) return;
          await updateDoc(albunsRef, { [nome]: deleteField() });
        };
        const nomeDiv = document.createElement("div");
        nomeDiv.textContent = nome;
        div.appendChild(btnExcluir);
        div.appendChild(nomeDiv);
        div.onclick = () => abrirAlbum(nome, albuns[nome]);
        listaAlbuns.appendChild(div);
      });
    }

    document.getElementById("novoAlbum").onclick = async () => {
      const nome = prompt("Nome do novo destaque:");
      if (!nome) return;
      const snap = await getDoc(albunsRef);
      const data = snap.exists() ? snap.data() : {};
      if (data[nome]) { alert("J√° existe um destaque com esse nome!"); return; }
      await setDoc(albunsRef, { [nome]: [] }, { merge: true });
    };

    function abrirAlbum(nome, midias = []) {
      albumAtual = nome;
      tituloAlbum.textContent = nome;
      telaAlbuns.style.display = "none";
      telaGaleria.style.display = "block";
      mostrarGaleria(midias);
    }

    function mostrarGaleria(midias) {
      galeria.innerHTML = "";
      if (!midias || midias.length === 0) {
        galeria.innerHTML = '<div class="empty">Nenhuma m√≠dia adicionada</div>';
        return;
      }
      midias.forEach((m, i) => {
        const el = document.createElement(m.tipo === "video" ? "video" : "img");
        el.src = m.url;
        if (m.tipo === "video") el.controls = true;
        el.onclick = async () => {
          if (!confirm("Remover esta m√≠dia?")) return;
          await deleteObject(ref(storage, m.path));
          const snap = await getDoc(albunsRef);
          const data = snap.data();
          data[albumAtual].splice(i, 1);
          await setDoc(albunsRef, data);
        };
        galeria.appendChild(el);
      });
    }

    document.getElementById("voltar").onclick = () => {
      telaAlbuns.style.display = "block";
      telaGaleria.style.display = "none";
    };

    document.getElementById("addFoto").onclick = () => fileInput.click();

    fileInput.onchange = async (e) => {
      const files = Array.from(e.target.files);
      if (!files.length || !albumAtual) return;
      for (const file of files) {
        const tipo = file.type.startsWith("video") ? "video" : "img";
        const filePath = `${albumAtual}/${Date.now()}_${file.name}`;
        const fileRef = ref(storage, filePath);
        await uploadBytes(fileRef, file);
        const url = await getDownloadURL(fileRef);
        const snap = await getDoc(albunsRef);
        const data = snap.exists() ? snap.data() : {};
        const midias = data[albumAtual] || [];
        midias.push({ tipo, url, path: filePath });
        await setDoc(albunsRef, { [albumAtual]: midias }, { merge: true });
      }
      fileInput.value = "";
    };

    // Atualiza√ß√£o em tempo real dos √°lbuns
    onSnapshot(albunsRef, (snap) => {
      const data = snap.exists() ? snap.data() : {};
      if (!albumAtual) mostrarAlbuns(data);
      else if (data[albumAtual]) mostrarGaleria(data[albumAtual]);
    });
  </script>
</body>
</html>
